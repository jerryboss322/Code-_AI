<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeAi ‚Ä¢ Programming Intelligence</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-cpp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-csharp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-go.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-rust.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-sql.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;600;700&family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <style>
        /* ‚îÄ‚îÄ BASE ‚îÄ‚îÄ */
        *, *::before, *::after { box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; -webkit-tap-highlight-color: transparent; }
        .logo-font { font-family: 'Space Grotesk', sans-serif; }

        /* ‚îÄ‚îÄ THIN DARK SCROLLBARS ‚îÄ‚îÄ */
        * { scrollbar-width: thin; scrollbar-color: rgb(39 39 42) transparent; }
        *::-webkit-scrollbar { width: 3px; height: 3px; }
        *::-webkit-scrollbar-track { background: transparent; }
        *::-webkit-scrollbar-thumb { background: rgb(39 39 42); border-radius: 10px; }
        *::-webkit-scrollbar-thumb:hover { background: rgb(63 63 70); }

        /* ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ */
        #sidebar {
            width: 240px; min-width: 240px;
            transition: transform 0.3s cubic-bezier(0.4,0,0.2,1);
        }
        @media (max-width: 767px) {
            #sidebar { position:fixed; top:0; left:0; bottom:0; z-index:50; transform:translateX(-100%); width:260px; }
            #sidebar.open { transform:translateX(0); }
        }
        #sidebar-overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.55); backdrop-filter:blur(2px); z-index:40; }
        #sidebar-overlay.show { display:block; }

        /* Logo */
        .sidebar-logo-icon {
            background: linear-gradient(135deg, rgb(59 130 246), rgb(6 182 212));
            box-shadow: 0 0 0 1px rgba(255,255,255,0.05) inset;
        }

        /* New chat btn */
        .btn-new-chat {
            display: flex; align-items: center; gap: 8px;
            width: 100%; padding: 8px 12px;
            background: rgb(39 39 42);
            border: 1px solid rgb(63 63 70);
            border-radius: 10px; color: #fff;
            font-size: 13px; font-weight: 500; cursor: pointer;
            transition: background 0.15s, border-color 0.15s;
        }
        .btn-new-chat:hover { background: rgb(63 63 70); border-color: rgb(82 82 91); }

        /* History item */
        .hist-item {
            display: flex; align-items: center; gap: 8px;
            padding: 7px 10px; border-radius: 8px; cursor: pointer;
            border: 1px solid transparent;
            transition: all 0.12s; position: relative;
            color: rgb(161 161 170); font-size: 13px;
        }
        .hist-item:hover { background: rgb(39 39 42); color: #fff; }
        .hist-item.active { background: rgb(39 39 42); border-color: rgb(63 63 70); color: #fff; }
        .hist-item .hist-del {
            opacity: 0; background: none; border: none; color: rgb(248 113 113);
            cursor: pointer; font-size: 12px; padding: 0 2px; margin-left: auto; flex-shrink: 0;
            transition: opacity 0.15s;
        }
        .hist-item:hover .hist-del { opacity: 1; }
        .hist-dot {
            width: 6px; height: 6px; border-radius: 50%;
            background: rgb(63 63 70); flex-shrink: 0;
            transition: background 0.15s;
        }
        .hist-item.active .hist-dot { background: rgb(59 130 246); box-shadow: 0 0 6px rgba(59,130,246,0.5); }

        /* ‚îÄ‚îÄ TOPBAR ‚Äî slim, non-fixed ‚îÄ‚îÄ */
        #topbar {
            height: 44px; flex-shrink: 0;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 16px;
            background: rgb(9 9 11);
            border-bottom: 1px solid rgb(24 24 27);
        }
        .btn-icon {
            display: flex; align-items: center; justify-content: center;
            width: 30px; height: 30px; border-radius: 7px; border: none;
            background: transparent; color: rgb(113 113 122); cursor: pointer;
            transition: background 0.15s, color 0.15s;
        }
        .btn-icon:hover { background: rgb(39 39 42); color: #fff; }

        /* ‚îÄ‚îÄ MAIN LAYOUT ‚îÄ‚îÄ */
        .main-col {
            flex: 1; display: flex; flex-direction: column;
            min-width: 0; overflow: hidden; position: relative;
        }

        /* ‚îÄ‚îÄ MESSAGES ‚Äî scrollable, bottom-padded for floating input ‚îÄ‚îÄ */
        #messages {
            flex: 1; overflow-y: auto;
            padding: 20px 0 140px;
        }
        .msg-inner { max-width: 700px; margin: 0 auto; padding: 0 16px; }

        /* ‚îÄ‚îÄ MESSAGE BUBBLES ‚Äî Claude-style ‚îÄ‚îÄ */
        .msg-row { display: flex; gap: 12px; margin-bottom: 20px; animation: msgIn 0.22s ease forwards; opacity: 0; }
        @keyframes msgIn { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:translateY(0)} }

        /* Avatar */
        .msg-avatar {
            width: 28px; height: 28px; border-radius: 7px; flex-shrink: 0; margin-top: 2px;
            display: flex; align-items: center; justify-content: center; font-size: 13px;
        }
        .msg-avatar.ai {
            background: linear-gradient(135deg, rgb(59 130 246), rgb(6 182 212));
            box-shadow: 0 2px 8px rgba(59,130,246,0.3);
        }
        .msg-avatar.user {
            background: rgb(39 39 42);
            border: 1px solid rgb(63 63 70);
        }

        /* AI message ‚Äî no background, just text like Claude */
        .msg-body { flex: 1; min-width: 0; }
        .msg-name { font-size: 12px; font-weight: 600; margin-bottom: 5px; }
        .msg-name.ai   { color: rgb(148 163 184); }
        .msg-name.user { color: rgb(96 165 250); }

        .msg-text { font-size: 14px; line-height: 1.75; color: rgb(228 228 231); }

        /* User message ‚Äî compact pill */
        .msg-row.user-row { flex-direction: row-reverse; }
        .msg-row.user-row .msg-body { display: flex; flex-direction: column; align-items: flex-end; }
        .user-bubble {
            background: rgb(37 99 235);
            border-radius: 16px 16px 4px 16px;
            padding: 10px 15px;
            max-width: 78%;
            font-size: 14px; line-height: 1.65; color: #fff;
            box-shadow: 0 2px 12px rgba(59,130,246,0.2);
        }
        @media (max-width: 640px) { .user-bubble { max-width: 90%; } }

        /* Thinking dots */
        .thinking { display:flex; gap:4px; padding:8px 0; align-items:center; }
        .thinking span {
            width:6px; height:6px; border-radius:50%; background:rgb(82 82 91);
            animation:think 1.3s ease-in-out infinite;
        }
        .thinking span:nth-child(2){animation-delay:.16s}
        .thinking span:nth-child(3){animation-delay:.32s}
        @keyframes think { 0%,80%,100%{opacity:.3;transform:scale(.8)} 40%{opacity:1;transform:scale(1.25)} }

        /* Typing cursor */
        .typing-cursor {
            display:inline-block; width:2px; height:1em;
            background:rgb(148 163 184); vertical-align:middle; margin-left:1px;
            animation:blink 0.8s step-end infinite;
        }
        @keyframes blink { 50%{opacity:0} }

        /* ‚îÄ‚îÄ PROSE / MARKDOWN ‚îÄ‚îÄ */
        .msg-text p { margin-bottom:10px; }
        .msg-text p:last-child { margin-bottom:0; }
        .msg-text h1,.msg-text h2,.msg-text h3 { font-family:'Space Grotesk',sans-serif; font-weight:600; color:#fff; margin:16px 0 8px; }
        .msg-text h1{font-size:18px} .msg-text h2{font-size:16px} .msg-text h3{font-size:14px}
        .msg-text ul,.msg-text ol { padding-left:18px; margin-bottom:10px; }
        .msg-text li { margin-bottom:3px; }
        .msg-text strong { color:#fff; font-weight:600; }
        .msg-text a { color:rgb(96 165 250); text-decoration:none; }
        .msg-text a:hover { text-decoration:underline; }
        .msg-text code:not(pre code) {
            font-family:'JetBrains Mono',monospace; font-size:12px;
            background:rgb(24 24 27); border:1px solid rgb(39 39 42);
            border-radius:4px; padding:1px 5px; color:rgb(125 211 252);
        }
        .msg-text blockquote {
            border-left:3px solid rgb(59 130 246); padding-left:12px;
            color:rgb(113 113 122); font-style:italic; margin:8px 0;
        }
        .msg-text table { width:100%; border-collapse:collapse; font-size:13px; margin:10px 0; }
        .msg-text th { background:rgb(24 24 27); border:1px solid rgb(39 39 42); padding:7px 11px; color:rgb(148 163 184); font-size:11px; letter-spacing:0.5px; text-align:left; }
        .msg-text td { border:1px solid rgb(24 24 27); padding:6px 11px; }
        .msg-text tr:nth-child(even) td { background:rgb(9 9 11 / 0.5); }

        /* ‚îÄ‚îÄ CODE BLOCKS ‚îÄ‚îÄ */
        .msg-text pre {
            background: rgb(9 9 11) !important;
            border: 1px solid rgb(39 39 42) !important;
            border-radius: 10px !important;
            margin: 12px 0; overflow: hidden;
            position: relative;
        }
        .code-toolbar {
            display: flex; align-items: center; justify-content: space-between;
            padding: 6px 12px;
            background: rgb(18 18 20);
            border-bottom: 1px solid rgb(39 39 42);
        }
        .code-lang {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px; letter-spacing: 1px; text-transform: uppercase;
            color: rgb(82 82 91);
        }
        .code-actions { display:flex; align-items:center; gap:6px; }
        .btn-copy, .btn-collapse {
            font-family: 'JetBrains Mono', monospace; font-size: 10px; letter-spacing: 0.3px;
            background: rgb(39 39 42); border: 1px solid rgb(63 63 70);
            color: rgb(161 161 170); padding: 2px 8px; border-radius: 5px;
            cursor: pointer; transition: all 0.15s;
        }
        .btn-copy:hover, .btn-collapse:hover { background: rgb(63 63 70); color: #fff; }
        .btn-copy.copied { color: rgb(74 222 128); border-color: rgb(74 222 128 / 0.4); }

        /* Collapsible code */
        .code-body { overflow: hidden; transition: max-height 0.3s ease; }
        .code-body.collapsed { max-height: 120px; position: relative; }
        .code-body.collapsed::after {
            content: '';
            position: absolute; bottom: 0; left: 0; right: 0; height: 50px;
            background: linear-gradient(transparent, rgb(9 9 11));
            pointer-events: none;
        }
        .msg-text pre code {
            font-family: 'JetBrains Mono', monospace !important;
            font-size: 12px !important; padding: 12px 14px !important;
            display: block; overflow-x: auto; line-height: 1.6;
        }

        /* ‚îÄ‚îÄ FLOATING INPUT ‚îÄ‚îÄ */
        #input-float {
            position: absolute; bottom: 0; left: 0; right: 0;
            padding: 12px 16px 16px;
            background: linear-gradient(to top, rgb(9 9 11) 70%, transparent);
        }
        .input-inner { max-width: 700px; margin: 0 auto; }
        .input-shell {
            display: flex; align-items: flex-end; gap: 8px;
            background: rgb(18 18 20);
            border: 1px solid rgb(39 39 42);
            border-radius: 14px;
            padding: 8px 8px 8px 14px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.4), 0 1px 3px rgba(0,0,0,0.3);
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .input-shell:focus-within {
            border-color: rgb(59 130 246 / 0.5);
            box-shadow: 0 4px 24px rgba(0,0,0,0.4), 0 0 0 3px rgba(59,130,246,0.1);
        }
        #user-input {
            flex: 1; background: none; border: none; outline: none;
            color: rgb(228 228 231); font-family: 'Inter', sans-serif;
            font-size: 14px; line-height: 1.55; resize: none;
            min-height: 22px; max-height: 130px; padding-top: 3px;
        }
        #user-input::placeholder { color: rgb(63 63 70); }
        #btn-send {
            width: 34px; height: 34px; flex-shrink: 0;
            background: rgb(37 99 235);
            border: none; border-radius: 9px; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            transition: background 0.15s, transform 0.15s, box-shadow 0.15s;
            box-shadow: 0 2px 8px rgba(59,130,246,0.3);
        }
        #btn-send:hover { background: rgb(29 78 216); transform: scale(1.06); box-shadow: 0 4px 14px rgba(59,130,246,0.45); }
        #btn-send:active { transform: scale(0.96); }
        #btn-send:disabled { background: rgb(39 39 42); box-shadow: none; cursor: not-allowed; transform: none; }
        #btn-send svg { color: #fff; }
        /* Spinner */
        .spinner {
            width: 16px; height: 16px;
            border: 2px solid rgba(255,255,255,0.25);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .input-hint { text-align:center; font-size:10px; color:rgb(63 63 70); margin-top:7px; font-family:'JetBrains Mono',monospace; letter-spacing:0.5px; }

        /* ‚îÄ‚îÄ WELCOME ‚îÄ‚îÄ */
        .welcome-icon { animation: floatIcon 4s ease-in-out infinite; }
        @keyframes floatIcon { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-7px)} }
        .quick-card { transition: transform 0.18s, box-shadow 0.18s, border-color 0.18s; }
        .quick-card:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.4); border-color: rgb(63 63 70) !important; }
        .quick-card:active { transform: translateY(0); }

        /* ‚îÄ‚îÄ ERROR TOAST ‚îÄ‚îÄ */
        .toast {
            position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%);
            background: rgb(24 24 27); border: 1px solid rgb(239 68 68 / 0.4);
            color: rgb(252 165 165); padding: 10px 18px; border-radius: 10px;
            font-size: 13px; font-family: 'Inter', sans-serif;
            box-shadow: 0 8px 30px rgba(0,0,0,0.4);
            z-index: 1000; pointer-events: none; white-space: nowrap;
            animation: toastIn 0.25s ease, toastOut 0.25s ease 3.75s forwards;
        }
        @keyframes toastIn  { from{opacity:0;transform:translateX(-50%) translateY(8px)} to{opacity:1;transform:translateX(-50%) translateY(0)} }
        @keyframes toastOut { to{opacity:0;transform:translateX(-50%) translateY(8px)} }

        /* ‚îÄ‚îÄ SETTINGS MODAL ‚îÄ‚îÄ */
        #settings-modal > div { box-shadow: 0 25px 60px rgba(0,0,0,0.5); }

        /* ‚îÄ‚îÄ MISC ‚îÄ‚îÄ */
        @media (max-width:767px) { #topbar .desktop-only { display:none; } }
    </style>
</head>

<body class="bg-zinc-950 text-zinc-100 flex h-screen overflow-hidden">
    <!-- Mobile overlay -->
    <div id="sidebar-overlay" onclick="closeSidebar()" aria-hidden="true"></div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SIDEBAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <aside id="sidebar" class="bg-zinc-900 border-r border-zinc-800 flex flex-col" role="navigation" aria-label="Sidebar">

        <!-- Logo -->
        <div class="flex items-center gap-2.5 px-3 py-3 border-b border-zinc-800">
            <div class="sidebar-logo-icon w-8 h-8 rounded-xl flex items-center justify-center text-lg flex-shrink-0" aria-hidden="true">ü§ñ</div>
            <div>
                <h1 class="logo-font text-lg font-semibold leading-tight text-white">CodeAi</h1>
                <p class="text-[9px] text-zinc-600 leading-tight" aria-label="Model info">GPT-OSS 20B ‚Ä¢ Groq</p>
            </div>
        </div>

        <!-- New Chat -->
        <div class="px-2.5 py-2.5">
            <button class="btn-new-chat" onclick="newChat()" aria-label="Start new conversation">
                <svg class="w-3.5 h-3.5 flex-shrink-0" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4"/>
                </svg>
                New chat
            </button>
        </div>

        <!-- History -->
        <div class="px-2 mb-1">
            <p class="text-[9px] text-zinc-600 font-medium tracking-widest px-2 py-1" aria-label="Chat history section">HISTORY</p>
        </div>
        <div class="flex-1 overflow-y-auto px-2 pb-2" id="chat-history" role="list" aria-label="Previous chats">
            <!-- JS renders here -->
        </div>

        <!-- Footer -->
        <div class="px-3 py-2.5 border-t border-zinc-800 flex items-center justify-between">
            <span class="text-[9px] text-zinc-600 font-mono tracking-wide">BY JEREMIAH</span>
            <button onclick="clearAllChats()" class="text-[9px] text-zinc-600 hover:text-red-400 transition-colors font-mono tracking-wide" aria-label="Clear all chat history">CLEAR ALL</button>
        </div>
    </aside>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MAIN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="main-col">

        <!-- TOPBAR ‚Äî slim, part of flow -->
        <header id="topbar" role="banner">
            <div class="flex items-center gap-2">
                <!-- Hamburger (mobile) -->
                <button class="btn-icon md:hidden" onclick="toggleSidebar()" aria-label="Open sidebar" aria-controls="sidebar">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/>
                    </svg>
                </button>
                <!-- Status chip -->
                <div class="flex items-center gap-1.5 bg-zinc-900 border border-zinc-800 rounded-full px-2.5 py-1" aria-label="Model status: online">
                    <span class="w-1.5 h-1.5 rounded-full bg-emerald-400 animate-pulse" aria-hidden="true"></span>
                    <span class="text-xs text-zinc-400 font-mono">GPT-OSS 20B</span>
                </div>
            </div>

            <div class="flex items-center gap-1">
                <button class="btn-icon desktop-only" onclick="showSettings()" aria-label="Open settings" aria-haspopup="dialog">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                </button>
                <span class="text-[9px] text-zinc-600 font-mono tracking-wide desktop-only px-1">v1.0</span>
                <!-- Mobile settings -->
                <button class="btn-icon md:hidden" onclick="showSettings()" aria-label="Open settings">
                    <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                </button>
            </div>
        </header>

        <!-- MESSAGES -->
        <div id="messages" class="bg-zinc-950" role="log" aria-live="polite" aria-label="Chat messages">
            <!-- JS renders here -->
        </div>

        <!-- FLOATING INPUT -->
        <div id="input-float" aria-label="Message input area">
            <div class="input-inner">
                <div class="input-shell">
                    <textarea
                        id="user-input"
                        rows="1"
                        placeholder="Ask anything about code‚Ä¶"
                        aria-label="Message input"
                        aria-multiline="true"
                        onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();sendMessage()}"
                    ></textarea>
                    <button
                        id="btn-send"
                        onclick="sendMessage()"
                        aria-label="Send message"
                    >
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.874L5.999 12zm0 0h7.07"/>
                        </svg>
                    </button>
                </div>
                <p class="input-hint" aria-hidden="true">ENTER to send &nbsp;¬∑&nbsp; SHIFT+ENTER new line &nbsp;¬∑&nbsp; ‚åòK focus</p>
            </div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SETTINGS MODAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="settings-modal" class="hidden fixed inset-0 bg-black/70 flex items-center justify-center z-50 px-4"
         role="dialog" aria-modal="true" aria-labelledby="settings-title">
        <div class="bg-zinc-900 border border-zinc-800 rounded-2xl w-full max-w-sm p-6">
            <h2 id="settings-title" class="logo-font text-xl font-semibold mb-5 text-white">Settings</h2>
            <div class="space-y-5">
                <div>
                    <label for="temp-slider" class="flex justify-between text-sm text-zinc-400 mb-2">
                        Temperature
                        <span id="temp-display" class="text-zinc-300 font-mono" aria-live="polite">0.7</span>
                    </label>
                    <input type="range" id="temp-slider" min="0" max="1" step="0.1" value="0.7"
                           class="w-full accent-blue-500"
                           oninput="document.getElementById('temp-display').textContent=this.value"
                           aria-label="Temperature setting">
                    <div class="flex justify-between text-[10px] text-zinc-600 mt-1">
                        <span>Precise</span><span>Creative</span>
                    </div>
                </div>
                <div>
                    <label for="max-tokens" class="block text-sm text-zinc-400 mb-2">Max Tokens</label>
                    <input type="number" id="max-tokens" value="2048"
                           class="bg-zinc-800 border border-zinc-700 rounded-xl px-3 py-2.5 w-full text-sm outline-none focus:border-blue-500 transition-colors"
                           aria-label="Maximum tokens">
                </div>
                <div class="pt-3 border-t border-zinc-800">
                    <button onclick="closeSettings()"
                            class="w-full py-2.5 bg-zinc-800 hover:bg-zinc-700 rounded-xl text-sm font-medium transition-colors"
                            aria-label="Close settings dialog">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ================== CONFIG ==================
        const GROQ_MODEL = "openai/gpt-oss-20b"
        const SYSTEM_PROMPT = `You are CodeAi ‚Äî an elite programming assistant powered by GPT-OSS 20B via Groq. 
You are extremely good at writing clean, production-ready code in any language. 
You explain concepts clearly, spot bugs instantly, and always provide complete working examples.
Use markdown with proper code blocks (specify language). 
Be concise but thorough. Never refuse a coding request.`

        let currentChatId = null
        let chats = []
        let isStreaming = false

        function initTailwind() {}

        // ================== STORAGE ==================
        function loadChats() {
            const saved = localStorage.getItem('codeai_chats')
            if (saved) {
                chats = JSON.parse(saved)
            } else {
                chats = [{ id: Date.now(), title: "Welcome to CodeAi", messages: [] }]
            }
            currentChatId = chats[0].id
            renderHistory()
        }

        function saveChats() {
            localStorage.setItem('codeai_chats', JSON.stringify(chats))
        }

        // ================== RENDER HISTORY ==================
        function renderHistory() {
            const container = document.getElementById('chat-history')
            container.innerHTML = ''

            chats.forEach(chat => {
                const isActive = chat.id === currentChatId
                const div = document.createElement('div')
                div.className = `hist-item ${isActive ? 'active' : ''}`
                div.setAttribute('role', 'listitem')
                div.setAttribute('aria-current', isActive ? 'true' : 'false')
                div.innerHTML = `
                    <span class="hist-dot" aria-hidden="true"></span>
                    <span class="flex-1 truncate">${escHtml(chat.title)}</span>
                    <button class="hist-del" onclick="deleteChat(${chat.id});event.stopImmediatePropagation()"
                            aria-label="Delete chat: ${escHtml(chat.title)}">‚úï</button>
                `
                div.onclick = () => switchChat(chat.id)
                container.appendChild(div)
            })
        }

        function escHtml(s) {
            return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')
        }

        function switchChat(id) {
            currentChatId = id
            renderHistory()
            renderMessages()
            if (window.innerWidth < 768) closeSidebar()
        }

        function deleteChat(id) {
            if (chats.length === 1) return showToast('Cannot delete the last chat', 'warn')
            chats = chats.filter(c => c.id !== id)
            if (currentChatId === id) currentChatId = chats[0].id
            saveChats(); renderHistory(); renderMessages()
        }

        function newChat() {
            const c = { id: Date.now(), title: "New Chat", messages: [] }
            chats.unshift(c); currentChatId = c.id
            saveChats(); renderHistory(); renderMessages()
            document.getElementById('user-input').focus()
        }

        function clearAllChats() {
            if (!confirm("Delete ALL chats permanently?")) return
            chats = [{ id: Date.now(), title: "Welcome to CodeAi", messages: [] }]
            currentChatId = chats[0].id
            saveChats(); renderHistory(); renderMessages()
        }

        // ================== MESSAGES RENDER ==================
        function getCurrentChat() {
            return chats.find(c => c.id === currentChatId)
        }

        function renderMessages() {
            const container = document.getElementById('messages')
            container.innerHTML = ''
            const chat = getCurrentChat()

            if (chat.messages.length === 0) {
                container.innerHTML = `
                    <div class="msg-inner flex flex-col items-center justify-center text-center py-16 min-h-full">
                        <div class="welcome-icon w-16 h-16 bg-gradient-to-br from-blue-500 to-cyan-400 rounded-2xl flex items-center justify-center text-4xl mb-5 shadow-xl shadow-blue-500/20" aria-hidden="true">ü§ñ</div>
                        <h2 class="text-3xl font-semibold logo-font tracking-tight mb-2 text-white">Hello, I'm CodeAi</h2>
                        <p class="text-zinc-400 text-sm max-w-sm mb-1 leading-relaxed">Your intelligent coding companion ‚Äî ready to debug, build, and explain anything across every language.</p>
                        <p class="text-zinc-600 text-xs font-mono tracking-widest mb-10">CRAFTED BY JEREMIAH</p>

                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-2.5 w-full max-w-lg">
                            <button onclick="quickPrompt('Write a FastAPI endpoint for user registration with JWT')"
                                    class="quick-card bg-zinc-900 border border-zinc-800 rounded-xl p-3.5 text-left" aria-label="Quick prompt: FastAPI user registration">
                                <div class="text-blue-400 text-[10px] font-mono mb-1.5 tracking-widest">FASTAPI</div>
                                <div class="font-medium text-sm text-zinc-100">User registration endpoint</div>
                                <div class="text-zinc-500 text-xs mt-0.5">JWT auth + validation</div>
                            </button>
                            <button onclick="quickPrompt('Explain how transformers work with a Python code example')"
                                    class="quick-card bg-zinc-900 border border-zinc-800 rounded-xl p-3.5 text-left" aria-label="Quick prompt: Transformers explained">
                                <div class="text-amber-400 text-[10px] font-mono mb-1.5 tracking-widest">AI CONCEPT</div>
                                <div class="font-medium text-sm text-zinc-100">Transformers explained</div>
                                <div class="text-zinc-500 text-xs mt-0.5">With working code</div>
                            </button>
                            <button onclick="quickPrompt('Write a custom React hook for data fetching with loading and error states')"
                                    class="quick-card bg-zinc-900 border border-zinc-800 rounded-xl p-3.5 text-left" aria-label="Quick prompt: React data-fetch hook">
                                <div class="text-cyan-400 text-[10px] font-mono mb-1.5 tracking-widest">REACT</div>
                                <div class="font-medium text-sm text-zinc-100">Custom data-fetch hook</div>
                                <div class="text-zinc-500 text-xs mt-0.5">Loading + error states</div>
                            </button>
                            <button onclick="quickPrompt('What are the most common Python async/await mistakes and how to fix them?')"
                                    class="quick-card bg-zinc-900 border border-zinc-800 rounded-xl p-3.5 text-left" aria-label="Quick prompt: Async/await pitfalls">
                                <div class="text-rose-400 text-[10px] font-mono mb-1.5 tracking-widest">DEBUG</div>
                                <div class="font-medium text-sm text-zinc-100">Async/await pitfalls</div>
                                <div class="text-zinc-500 text-xs mt-0.5">Common mistakes fixed</div>
                            </button>
                        </div>
                    </div>
                `
                return
            }

            const inner = document.createElement('div')
            inner.className = 'msg-inner py-4'

            chat.messages.forEach((msg, index) => {
                const isUser = msg.role === 'user'
                const row = document.createElement('div')
                row.className = `msg-row ${isUser ? 'user-row' : ''}`
                row.setAttribute('role', 'article')
                row.setAttribute('aria-label', `${isUser ? 'Your' : 'CodeAi'} message`)

                if (isUser) {
                    row.innerHTML = `
                        <div class="msg-avatar user" aria-hidden="true">üë§</div>
                        <div class="msg-body">
                            <div class="msg-name user">You</div>
                            <div class="user-bubble">${escHtml(msg.content)}</div>
                        </div>`
                } else {
                    const isEmpty = msg.content === ''
                    row.innerHTML = `
                        <div class="msg-avatar ai" aria-hidden="true">ü§ñ</div>
                        <div class="msg-body">
                            <div class="msg-name ai">CodeAi</div>
                            <div class="msg-text" id="msg-${index}">
                                ${isEmpty ? '<div class="thinking" aria-label="Thinking"><span></span><span></span><span></span></div>' : ''}
                            </div>
                        </div>`
                }

                inner.appendChild(row)

                if (!isUser && msg.content !== '') {
                    const el = document.getElementById(`msg-${index}`)
                    el.innerHTML = marked.parse(msg.content)
                    Prism.highlightAllUnder(el)
                    addCodeToolbars(el)
                }
            })

            container.appendChild(inner)
            container.scrollTop = container.scrollHeight
        }

        // ================== CODE TOOLBARS + COLLAPSIBLE ==================
        const COLLAPSE_THRESHOLD = 15 // lines

        function addCodeToolbars(container) {
            container.querySelectorAll('pre').forEach(pre => {
                if (pre.querySelector('.code-toolbar')) return

                const code = pre.querySelector('code')
                const lang = code?.className?.match(/language-(\w+)/)?.[1] || 'code'
                const lines = (code?.textContent || '').split('\n').length
                const isLong = lines > COLLAPSE_THRESHOLD

                // Wrap code in collapsible div
                const codeBody = document.createElement('div')
                codeBody.className = `code-body${isLong ? ' collapsed' : ''}`
                while (pre.childNodes.length) codeBody.appendChild(pre.firstChild)
                pre.appendChild(codeBody)

                // Toolbar
                const toolbar = document.createElement('div')
                toolbar.className = 'code-toolbar'
                toolbar.innerHTML = `
                    <span class="code-lang">${lang}</span>
                    <div class="code-actions">
                        ${isLong ? `<button class="btn-collapse" data-collapsed="true" aria-expanded="false" aria-label="Expand code block">Show more</button>` : ''}
                        <button class="btn-copy" aria-label="Copy code to clipboard">Copy</button>
                    </div>`
                pre.insertBefore(toolbar, codeBody)

                // Copy
                toolbar.querySelector('.btn-copy').onclick = function() {
                    navigator.clipboard.writeText(code.textContent)
                    this.textContent = '‚úì Copied'
                    this.classList.add('copied')
                    setTimeout(() => { this.textContent = 'Copy'; this.classList.remove('copied') }, 2000)
                }

                // Collapse toggle
                if (isLong) {
                    toolbar.querySelector('.btn-collapse').onclick = function() {
                        const collapsed = this.dataset.collapsed === 'true'
                        codeBody.classList.toggle('collapsed', !collapsed)
                        this.dataset.collapsed = String(!collapsed)
                        this.textContent = collapsed ? 'Show less' : 'Show more'
                        this.setAttribute('aria-expanded', String(collapsed))
                    }
                }
            })
        }

        function appendMessage(role, content) {
            const chat = getCurrentChat()
            chat.messages.push({ role, content })
            saveChats(); renderMessages()
        }

        function updateLastMessage(content) {
            const chat = getCurrentChat()
            if (chat.messages.length === 0) return
            const last = chat.messages[chat.messages.length - 1]
            if (last.role === 'assistant') {
                last.content = content
                saveChats(); renderMessages()
            }
        }

        // ================== STREAMING ==================
        async function sendMessage() {
            const input = document.getElementById('user-input')
            const text = input.value.trim()
            if (!text || isStreaming) return

            isStreaming = true
            setSendLoading(true)

            const chat = getCurrentChat()
            chat.messages.push({ role: "user", content: text })
            if (chat.messages.length === 1) {
                chat.title = text.length > 35 ? text.substring(0, 32) + "..." : text
            }
            saveChats(); renderMessages()
            input.value = ''; input.style.height = 'auto'

            chat.messages.push({ role: "assistant", content: "" })
            saveChats(); renderMessages()

            const fullMessages = [
                { role: "system", content: SYSTEM_PROMPT },
                ...chat.messages
            ]

            try {
                const temperature = parseFloat(document.getElementById('temp-slider')?.value || 1)
                const max_tokens  = parseInt(document.getElementById('max-tokens')?.value || 8192)

                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ messages: fullMessages, temperature, max_tokens })
                })

                if (!response.ok) throw new Error(`Server error: ${response.status}`)

                const reader  = response.body.getReader()
                const decoder = new TextDecoder()
                let buffer = '', fullContent = ''

                while (true) {
                    const { done, value } = await reader.read()
                    if (done) break

                    buffer += decoder.decode(value, { stream: true })
                    const lines = buffer.split('\n')
                    buffer = lines.pop()

                    for (const line of lines) {
                        const trimmed = line.trim()
                        if (!trimmed || !trimmed.startsWith('data: ')) continue
                        const dataStr = trimmed.slice(6).trim()

                        if (dataStr === '[DONE]') {
                            const lastMsgDiv = document.querySelector('#messages .msg-row:last-child .msg-text')
                            if (lastMsgDiv) {
                                lastMsgDiv.innerHTML = marked.parse(fullContent)
                                Prism.highlightAllUnder(lastMsgDiv)
                                addCodeToolbars(lastMsgDiv)
                            }
                            break
                        }

                        try {
                            const parsed = JSON.parse(dataStr)
                            const delta = parsed?.choices?.[0]?.delta
                            if (delta?.content) {
                                fullContent += delta.content
                                updateLastMessage(fullContent)
                            }
                            if (parsed?.error) throw new Error(parsed.error)
                        } catch (e) {
                            if (e.message && !e.message.startsWith('Unexpected')) throw e
                        }
                    }
                }

            } catch (err) {
                console.error(err)
                showToast('‚ùå ' + err.message)
                chat.messages.pop()
                saveChats(); renderMessages()
            } finally {
                isStreaming = false
                setSendLoading(false)
            }
        }

        // ‚îÄ‚îÄ Send button state ‚îÄ‚îÄ
        function setSendLoading(loading) {
            const btn = document.getElementById('btn-send')
            if (loading) {
                btn.disabled = true
                btn.innerHTML = '<div class="spinner" aria-label="Sending‚Ä¶"></div>'
            } else {
                btn.disabled = false
                btn.innerHTML = `<svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2.5" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.874L5.999 12zm0 0h7.07"/></svg>`
            }
        }

        // ‚îÄ‚îÄ Toast ‚îÄ‚îÄ
        function showToast(msg, type = 'error') {
            const t = document.createElement('div')
            t.className = 'toast'
            t.setAttribute('role', 'alert')
            t.setAttribute('aria-live', 'assertive')
            t.textContent = msg
            if (type === 'warn') t.style.borderColor = 'rgb(234 179 8 / 0.4)', t.style.color = 'rgb(253 224 71)'
            document.body.appendChild(t)
            setTimeout(() => t.remove(), 4100)
        }

        function quickPrompt(prompt) {
            document.getElementById('user-input').value = prompt
            sendMessage()
        }

        // ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open')
            document.getElementById('sidebar-overlay').classList.toggle('show')
        }
        function closeSidebar() {
            document.getElementById('sidebar').classList.remove('open')
            document.getElementById('sidebar-overlay').classList.remove('show')
        }

        // ‚îÄ‚îÄ Settings ‚îÄ‚îÄ
        function showSettings() {
            document.getElementById('settings-modal').classList.remove('hidden')
            document.getElementById('settings-modal').focus()
        }
        function closeSettings() {
            document.getElementById('settings-modal').classList.add('hidden')
        }

        // ================== INIT ==================
        function init() {
            initTailwind()
            loadChats()
            renderMessages()

            setTimeout(() => document.getElementById('user-input').focus(), 300)

            document.addEventListener('keydown', e => {
                if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                    e.preventDefault()
                    document.getElementById('user-input').focus()
                }
                if (e.key === 'Escape') closeSettings()
            })

            const ta = document.getElementById('user-input')
            ta.addEventListener('input', () => {
                ta.style.height = 'auto'
                ta.style.height = Math.min(ta.scrollHeight, 130) + 'px'
            })

            // Close settings on backdrop click
            document.getElementById('settings-modal').addEventListener('click', function(e) {
                if (e.target === this) closeSettings()
            })
        }

        window.onload = init
    </script>
</body>
</html>
